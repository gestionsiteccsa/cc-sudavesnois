{% extends 'base.html' %}
{% load static %}
{% block content %}

<!-- Bannière -->
<section class="relative bg-primary text-white py-16 md:py-24 overflow-hidden reveal">
    <div class="container mx-auto px-4 md:px-6 relative z-10">
        <div class="max-w-3xl mx-auto text-center">
            <h1 class="text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-bold mb-6" style="font-display: swap;">Bienvenue sur le site de la Communauté de Communes <br>Sud-Avesnois</h1>
            <p class="text-xl mb-8">Un territoire dynamique au service de ses habitants et de son développement économique, touristique et culturel.</p>
            <div class="flex flex-wrap gap-4 justify-center">
                <a href="https://www.facebook.com/ComdeComSudAvesnois/" target="_blank" rel="noopener" class="inline-flex items-center bg-white text-[#1877F2] font-medium px-6 py-3 rounded-md hover:bg-gray-100 transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-primary" aria-label="Visitez notre page Facebook (nouvelle fenêtre)">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                        <path d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33v6.988C18.343 21.128 22 16.991 22 12z"/>
                    </svg>
                    Facebook
                </a>
                <a href="https://www.linkedin.com/company/cc-sud-avesnois/" target="_blank" rel="noopener" class="inline-flex items-center bg-white text-primary font-medium px-6 py-3 rounded-md transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-secondary focus:ring-offset-2 focus:ring-offset-primary" aria-label="Visitez notre page LinkedIn (nouvelle fenêtre)">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                        <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452z"/>
                    </svg>
                    LinkedIn
                </a>
                {% if dernier_journal %}
                <a href="{{ dernier_journal.document.url }}" target="_blank" rel="noopener" class="inline-flex items-center bg-secondary text-white font-medium px-6 py-3 rounded-md hover:bg-secondary/90 transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-primary shadow-lg" aria-label="Télécharger le dernier numéro de Mon Sud Avesnois n°{{ dernier_journal.number }} (PDF, nouvelle fenêtre)">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6zM6 20V4h7v5h5v11H6zm2-6h8v2H8v-2zm0-3h8v2H8v-2zm0 6h5v2H8v-2z"/>
                    </svg>
                    Mon Sud Avesnois n°{{ dernier_journal.number }}
                </a>
                {% endif %}
            </div>
        </div>
    </div>
            
    <!-- Formes décoratives -->
    <div class="absolute top-0 right-0 w-full h-full overflow-hidden opacity-10" aria-hidden="true">
        <img src="{% static 'img/ban.svg' %}" alt="" class="w-full h-full object-cover object-center">
    </div>
</section>
    

        <!-- Présentation -->
        <section class="py-16 reveal">
            <div class="container mx-auto px-4 md:px-6">
                <div class="grid md:grid-cols-2 gap-12 items-center">
                    <div>
                        <h2 class="text-3xl md:text-4xl font-bold text-gray-800 mb-6 dark:text-white">La Communauté de Communes <span class="whitespace-nowrap">Sud-Avesnois</span></h2>
                        <p class="text-lg text-gray-600 mb-6">La Communauté de Communes Sud-Avesnois (CCSA) est un établissement public de coopération intercommunale (EPCI) qui regroupe {% if nb_communes != None %}{{ nb_communes }}{% else %}des{% endif %} communes du sud de l'Avesnois.</p>
                        <p class="text-lg text-gray-600 mb-6">Créée le 1er janvier 2014, elle exerce de nombreuses compétences au service de ses habitants : développement économique, aménagement du territoire, protection de l'environnement, gestion des déchets, tourisme...</p>
                        <div class="flex flex-wrap gap-4">
                            <a href="{% url 'presentation' %}" class="inline-flex items-center justify-center min-h-[44px] min-w-[44px] bg-primary text-white font-medium px-6 py-3 rounded-md hover:bg-primary/90 transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 focus:ring-offset-primary" aria-label="En savoir plus sur la Communauté de Communes Sud-Avesnois">
                                En savoir plus
                            </a>
                            <a href="{% url 'competences:competences' %}" class="inline-flex items-center min-h-[44px] min-w-[44px] bg-white text-primary font-medium px-6 py-3 rounded-md border border-primary hover:bg-gray-50 transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 focus:ring-offset-primary">
                                Nos compétences
                            </a>
                        </div>
                    </div>
                    <div class="relative flex justify-center">
                        <div style="max-width: 450px;" class="relative">
                            <img src="{% static 'img/carteSA.svg' %}" alt="Carte du territoire Sud-Avesnois" class="rounded-lg w-full h-auto" width="450" height="300" loading="lazy">
                            {% if nb_communes != None and nb_habitants != None %}
                            <div class="absolute -bottom-6 -left-6 bg-secondary text-white p-4 rounded-lg shadow-lg">
                                <p class="font-bold text-xl">{{ nb_communes }} communes</p>
                                <p>{{ nb_habitants }} habitants</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Formulaire de contact -->
        <section class="py-16 bg-primary text-white reveal" id="contact">
            <div class="container mx-auto px-4 md:px-6">
                <div class="max-w-3xl mx-auto">
                    <h2 class="text-3xl md:text-4xl font-bold mb-6 text-center">Contactez-nous</h2>
                    <p class="text-xl mb-8 text-center">Vous avez une question ou une demande ? N'hésitez pas à nous contacter via le formulaire ci-dessous ou par téléphone au 03 27 60 65 24</p>
                    
                    <!-- Légende pour les champs obligatoires -->
                    <p class="text-sm mb-6 text-center">Les champs marqués d'un astérisque (*) sont obligatoires.</p>
                    
                    <!-- Div pour les messages d'erreur non-field avec aria-live -->
                    <div id="form-feedback" aria-live="polite" class="mb-6">
                        {% if contact_form.non_field_errors %}
                            <div class="bg-white border-2 border-red-500 text-gray-900 px-4 py-3 rounded mb-4">
                                <ul class="list-disc list-inside">
                                    {% for error in contact_form.non_field_errors %}
                                        <li>{{ error }}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                        {% endif %}
                    </div>
                    
                    <form method="POST" class="space-y-6" >
                        {% csrf_token %}
                        <fieldset class="space-y-6">
                            <legend class="sr-only">Vos coordonnées</legend>
                            <div class="grid md:grid-cols-2 gap-6">
                                <div>
                                    <label for="last_name" class="block text-white font-medium mb-2">Nom <span class="text-red-300" aria-hidden="true">*</span><span class="sr-only">obligatoire</span></label>
                                <input type="text" id="last_name" name="last_name" value="{% if contact_form.last_name.value %}{{ contact_form.last_name.value }}{% endif %}" class="w-full px-4 py-3 rounded-md text-gray-800 focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-primary {% if contact_form.last_name.errors %}border-2 border-red-500{% endif %}" 
                                    placeholder="Votre nom" required autocomplete="family-name" aria-describedby="nom-error" {% if contact_form.last_name.errors %}aria-invalid="true"{% endif %}>
                                <div id="nom-error" class="text-red-200 text-sm mt-1 font-medium {% if not contact_form.last_name.errors %}hidden{% endif %}">
                                    {% if contact_form.last_name.errors %}
                                        {% for error in contact_form.last_name.errors %}
                                            <p>{{ error }}</p>
                                        {% endfor %}
                                    {% endif %}
                                </div>
                            </div>
                            <div>
                                <label for="first_name" class="block text-white font-medium mb-2">Prénom <span class="text-red-300" aria-hidden="true">*</span><span class="sr-only">obligatoire</span></label>
                                <input type="text" id="first_name" name="first_name" value="{% if contact_form.first_name.value %}{{ contact_form.first_name.value }}{% endif %}" class="w-full px-4 py-3 rounded-md text-gray-800 focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-primary {% if contact_form.first_name.errors %}border-2 border-red-500{% endif %}" 
                                    placeholder="Votre prénom" required autocomplete="given-name" aria-describedby="prenom-error" {% if contact_form.first_name.errors %}aria-invalid="true"{% endif %}>
                                <div id="prenom-error" class="text-red-200 text-sm mt-1 font-medium {% if not contact_form.first_name.errors %}hidden{% endif %}">
                                    {% if contact_form.first_name.errors %}
                                        {% for error in contact_form.first_name.errors %}
                                            <p>{{ error }}</p>
                                        {% endfor %}
                                    {% endif %}
                                </div>
                                </div>
                            </div>

                            <div class="grid md:grid-cols-2 gap-6">
                                <div>
                                    <label for="email" class="block text-white font-medium mb-2">Email <span class="text-red-300" aria-hidden="true">*</span><span class="sr-only">obligatoire</span></label>
                                <input type="email" id="email" name="email" value="{% if contact_form.email.value %}{{ contact_form.email.value }}{% endif %}" class="w-full px-4 py-3 rounded-md text-gray-800 focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-primary {% if contact_form.email.errors %}border-2 border-red-500{% endif %}" 
                                    placeholder="exemple@domaine.fr" required autocomplete="email" aria-describedby="email-format email-error" {% if contact_form.email.errors %}aria-invalid="true"{% endif %}>
                                <p id="email-format" class="text-sm mt-1">Format attendu : nom@domaine.fr</p>
                                <div id="email-error" class="text-red-200 text-sm mt-1 font-medium {% if not contact_form.email.errors %}hidden{% endif %}">
                                    {% if contact_form.email.errors %}
                                        {% for error in contact_form.email.errors %}
                                            <p>{{ error }}</p>
                                        {% endfor %}
                                    {% endif %}
                                </div>
                            </div>
                            <div>
                                <label for="phone" class="block text-white font-medium mb-2">Téléphone</label>
                                <input type="tel" id="phone" name="phone" value="{% if contact_form.phone.value %}{{ contact_form.phone.value }}{% endif %}" class="w-full px-4 py-3 rounded-md text-gray-800 focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-primary {% if contact_form.phone.errors %}border-2 border-red-500{% endif %}" 
                                    placeholder="01 23 45 67 89" autocomplete="tel" aria-describedby="tel-format tel-error" {% if contact_form.phone.errors %}aria-invalid="true"{% endif %}>
                                <p id="tel-format" class="text-sm mt-1">Format : 01 23 45 67 89</p>
                                <div id="tel-error" class="text-red-200 text-sm mt-1 font-medium {% if not contact_form.phone.errors %}hidden{% endif %}">
                                    {% if contact_form.phone.errors %}
                                        {% for error in contact_form.phone.errors %}
                                            <p>{{ error }}</p>
                                        {% endfor %}
                                    {% endif %}
                                </div>
                            </div>
                            </div>
                        </fieldset>

                        <fieldset>
                            <legend class="sr-only">Votre message</legend>
                            <div>
                                <label for="message" class="block text-white font-medium mb-2">Message <span class="text-red-300" aria-hidden="true">*</span><span class="sr-only">obligatoire</span></label>
                            <textarea id="message" name="message" rows="5" class="w-full px-4 py-3 rounded-md text-gray-800 focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-primary {% if contact_form.message.errors %}border-2 border-red-500{% endif %}"
                                    placeholder="Votre message" required aria-describedby="message-error" {% if contact_form.message.errors %}aria-invalid="true"{% endif %}>{% if contact_form.message.value %}{{ contact_form.message.value }}{% endif %}</textarea>
                                <div id="message-error" class="text-red-200 text-sm mt-1 font-medium {% if not contact_form.message.errors %}hidden{% endif %}">
                                    {% if contact_form.message.errors %}
                                        {% for error in contact_form.message.errors %}
                                            <p>{{ error }}</p>
                                        {% endfor %}
                                    {% endif %}
                                </div>
                            </div>
                        </fieldset>

                        <div class="flex items-start">
                            <div class="flex items-center h-5">
                                <input id="rgpd" name="rgpd" type="checkbox" class="h-4 w-4 text-secondary focus:ring-secondary border-gray-300 rounded {% if contact_form.rgpd.errors %}border-red-500{% endif %}" {% if contact_form.rgpd.value %}checked{% endif %} required aria-describedby="rgpd-error" {% if contact_form.rgpd.errors %}aria-invalid="true"{% endif %}>
                            </div>
                            <div class="ml-3 text-sm">
                                <label for="rgpd" class="font-medium text-white">J'accepte que mes données soient traitées conformément à la politique de confidentialité <span class="text-red-300" aria-hidden="true">*</span><span class="sr-only">obligatoire</span></label>
                                <div id="rgpd-error" class="text-red-200 text-sm mt-1 font-medium {% if not contact_form.rgpd.errors %}hidden{% endif %}">
                                    {% if contact_form.rgpd.errors %}
                                        {% for error in contact_form.rgpd.errors %}
                                            <p>{{ error }}</p>
                                        {% endfor %}
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        
                        <div class="text-center">
                            <button type="submit" class="bg-lime-700 text-white font-medium px-8 py-3 rounded-md hover:bg-lime/70 transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-primary">
                                Envoyer
                            </button>
                        </div>
                    </form>
                    
                    <div class="mt-8 text-sm text-center">
                        <p>Les informations recueillies font l'objet d'un traitement informatique destiné à répondre à votre demande. Conformément à la loi "Informatique et Libertés", vous bénéficiez d'un droit d'accès et de rectification aux informations qui vous concernent.</p>
                    </div>
                </div>
            </div>
        </section>
 
{% endblock %}

{% block script %}
<script>
    // Scroller vers la section contact si le formulaire a des erreurs
    document.addEventListener('DOMContentLoaded', function() {
        {% if form_has_errors %}
        // Attendre un court délai pour s'assurer que la page est complètement chargée
        setTimeout(function() {
            const contactSection = document.getElementById('contact');
            if (contactSection) {
                // Scroller vers la section avec un offset pour le header fixe
                const headerHeight = 80; // Hauteur approximative du header
                const elementPosition = contactSection.getBoundingClientRect().top;
                const offsetPosition = elementPosition + window.pageYOffset - headerHeight;
                
                window.scrollTo({
                    top: offsetPosition,
                    behavior: 'smooth'
                });
                
                // Mettre le focus sur le premier champ en erreur pour l'accessibilité
                const firstErrorField = contactSection.querySelector('[aria-invalid="true"]');
                if (firstErrorField) {
                    firstErrorField.focus();
                }
            }
        }, 100);
        {% endif %}
    });
</script>
{% endblock %}