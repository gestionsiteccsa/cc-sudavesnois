{% extends 'admin_base.html' %}
{% load static %}

{% block title %}Ajouter un partenaire{% endblock %}

{% block content %}
<div class="bg-gray-100 dark:bg-gray-900 py-12 min-h-screen">
    <div class="container mx-auto px-4 md:px-6">
        <div class="mb-8">
            <h1 class="text-3xl font-bold text-gray-900 dark:text-white">Ajouter un partenaire</h1>
            <p class="text-gray-600 dark:text-gray-300 mt-2">Cr√©ez un nouveau partenaire pour la CCSA</p>
        </div>

        <!-- Messages -->
        {% if messages %}
        <div class="mb-6">
            {% for message in messages %}
            <div class="p-4 rounded-lg {% if message.tags == 'success' %}bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200{% else %}bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200{% endif %}">
                {{ message }}
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Layout 2 colonnes : Formulaire + Sidebar -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            
            <!-- Colonne gauche : Formulaire -->
            <div class="lg:col-span-2">
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
                    <form method="post" enctype="multipart/form-data" class="space-y-6" id="partenaireForm">
                        {% csrf_token %}

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="id_nom" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Nom <span class="text-red-500">*</span></label>
                                {{ form.nom }}
                                {% if form.nom.errors %}
                                <p class="mt-1 text-sm text-red-600 dark:text-red-400">{{ form.nom.errors.0 }}</p>
                                {% endif %}
                            </div>

                            <div>
                                <label for="id_categorie" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Cat√©gorie (optionnel)</label>
                                {{ form.categorie }}
                                {% if form.categorie.errors %}
                                <p class="mt-1 text-sm text-red-600 dark:text-red-400">{{ form.categorie.errors.0 }}</p>
                                {% endif %}
                            </div>
                        </div>

                        <div>
                            <label for="id_description" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Description <span class="text-red-500">*</span></label>
                            {{ form.description }}
                            <!-- Aide Markdown sous le champ -->
                            <p class="mt-2 text-xs text-gray-500 dark:text-gray-400">
                                üí° <strong>Astuce :</strong> Vous pouvez utiliser la syntaxe Markdown pour les liens. 
                                <a href="#" onclick="document.getElementById('markdown-help').scrollIntoView({behavior: 'smooth'}); return false;" class="text-primary hover:underline">Voir les exemples ‚Üí</a>
                            </p>
                            {% if form.description.errors %}
                            <p class="mt-1 text-sm text-red-600 dark:text-red-400">{{ form.description.errors.0 }}</p>
                            {% endif %}
                        </div>

                        <!-- Type de lien -->
                        <div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-200 dark:border-blue-800">
                            <label for="id_type_lien" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Type de lien <span class="text-red-500">*</span></label>
                            {{ form.type_lien }}
                            {% if form.type_lien.help_text %}
                            <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">{{ form.type_lien.help_text }}</p>
                            {% endif %}
                            {% if form.type_lien.errors %}
                            <p class="mt-1 text-sm text-red-600 dark:text-red-400">{{ form.type_lien.errors.0 }}</p>
                            {% endif %}

                            <!-- Lien externe (URL) -->
                            <div id="lien-externe-field" class="mt-4 hidden">
                                <label for="id_site_web" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Site web (URL) <span class="text-red-500">*</span></label>
                                {{ form.site_web }}
                                {% if form.site_web.help_text %}
                                <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">{{ form.site_web.help_text }}</p>
                                {% endif %}
                                {% if form.site_web.errors %}
                                <p class="mt-1 text-sm text-red-600 dark:text-red-400">{{ form.site_web.errors.0 }}</p>
                                {% endif %}
                            </div>

                            <!-- Lien interne (page du site) -->
                            <div id="lien-interne-field" class="mt-4 hidden">
                                <label for="id_lien_interne" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Page du site <span class="text-red-500">*</span></label>
                                {{ form.lien_interne }}
                                {% if form.lien_interne.help_text %}
                                <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">{{ form.lien_interne.help_text }}</p>
                                {% endif %}
                                {% if form.lien_interne.errors %}
                                <p class="mt-1 text-sm text-red-600 dark:text-red-400">{{ form.lien_interne.errors.0 }}</p>
                                {% endif %}
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="id_logo" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Logo</label>
                                {{ form.logo }}
                                <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">Formats accept√©s : PNG, JPG, JPEG, WEBP, SVG. Max 60 Mo.</p>
                                {% if form.logo.errors %}
                                <p class="mt-1 text-sm text-red-600 dark:text-red-400">{{ form.logo.errors.0 }}</p>
                                {% endif %}
                            </div>

                            <div>
                                <label for="id_couleur_fond" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Couleur de fond du logo</label>
                                {{ form.couleur_fond }}
                                <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">Choisissez une couleur adapt√©e √† votre logo.</p>
                                {% if form.couleur_fond.errors %}
                                <p class="mt-1 text-sm text-red-600 dark:text-red-400">{{ form.couleur_fond.errors.0 }}</p>
                                {% endif %}
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="id_ordre" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Ordre d'affichage</label>
                                {{ form.ordre }}
                                {% if form.ordre.errors %}
                                <p class="mt-1 text-sm text-red-600 dark:text-red-400">{{ form.ordre.errors.0 }}</p>
                                {% endif %}
                                <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">Les partenaires sont tri√©s par ordre croissant</p>
                            </div>

                            <div class="flex items-center">
                                <div class="flex items-center h-full pt-6">
                                    {{ form.active }}
                                    <label for="id_active" class="ml-2 block text-sm text-gray-700 dark:text-gray-300">Actif</label>
                                </div>
                            </div>
                        </div>

                        <div class="flex items-center">
                            {{ form.active }}
                            <label for="id_active" class="ml-2 block text-sm text-gray-700 dark:text-gray-300">Actif</label>
                        </div>

                        <div class="flex items-center justify-between pt-6 border-t border-gray-200 dark:border-gray-700">
                            <a href="{% url 'partenaires:admin_partenaires_list' %}" class="text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-200">
                                ‚Üê Retour √† la liste
                            </a>                    
                            <button type="submit" class="inline-flex items-center px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors">
                                Ajouter le partenaire
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Colonne droite : Sidebar Markdown -->
            <div class="lg:col-span-1">
                <div id="markdown-help" class="bg-white dark:bg-gray-800 rounded-lg shadow p-6 sticky top-6">
                    <div class="flex items-center gap-2 mb-4">
                        <div class="bg-indigo-100 dark:bg-indigo-900 p-2 rounded-lg">
                            <svg class="w-5 h-5 text-indigo-600 dark:text-indigo-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                        </div>
                        <h2 class="text-lg font-semibold text-gray-900 dark:text-white">Guide Markdown</h2>
                    </div>
                    
                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">
                        Utilisez cette syntaxe pour enrichir vos descriptions :
                    </p>

                    <div class="space-y-4">
                        <!-- Lien avec texte -->
                        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-3">
                            <h3 class="text-sm font-medium text-gray-900 dark:text-white mb-2">üîó Lien avec texte</h3>
                            <code class="block text-xs bg-gray-100 dark:bg-gray-600 px-2 py-1 rounded font-mono text-gray-700 dark:text-gray-300">
                                [cliquez ici](https://example.com)
                            </code>
                            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">R√©sultat : <a href="#" class="text-primary">cliquez ici</a></p>
                        </div>

                        <!-- URL directe -->
                        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-3">
                            <h3 class="text-sm font-medium text-gray-900 dark:text-white mb-2">üåê URL directe</h3>
                            <code class="block text-xs bg-gray-100 dark:bg-gray-600 px-2 py-1 rounded font-mono text-gray-700 dark:text-gray-300">
                                https://www.example.com
                            </code>
                            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Converti automatiquement en lien</p>
                        </div>

                        <!-- Texte en gras -->
                        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-3">
                            <h3 class="text-sm font-medium text-gray-900 dark:text-white mb-2">üí™ Texte en gras</h3>
                            <code class="block text-xs bg-gray-100 dark:bg-gray-600 px-2 py-1 rounded font-mono text-gray-700 dark:text-gray-300">
                                **texte important**
                            </code>
                            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">R√©sultat : <strong>texte important</strong></p>
                        </div>

                        <!-- Texte en italique -->
                        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-3">
                            <h3 class="text-sm font-medium text-gray-900 dark:text-white mb-2">‚úçÔ∏è Texte en italique</h3>
                            <code class="block text-xs bg-gray-100 dark:bg-gray-600 px-2 py-1 rounded font-mono text-gray-700 dark:text-gray-300">
                                *texte emphatique*
                            </code>
                            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">R√©sultat : <em>texte emphatique</em></p>
                        </div>

                        <!-- Retour √† la ligne -->
                        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-3">
                            <h3 class="text-sm font-medium text-gray-900 dark:text-white mb-2">‚èé Retour √† la ligne</h3>
                            <p class="text-xs text-gray-600 dark:text-gray-400">
                                Appuyez sur <kbd class="bg-gray-200 dark:bg-gray-600 px-1 rounded">Entr√©e</kbd> pour cr√©er un nouveau paragraphe
                            </p>
                        </div>

                        <!-- Email -->
                        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-3">
                            <h3 class="text-sm font-medium text-gray-900 dark:text-white mb-2">üìß Lien email</h3>
                            <code class="block text-xs bg-gray-100 dark:bg-gray-600 px-2 py-1 rounded font-mono text-gray-700 dark:text-gray-300">
                                [contact](mailto:email@exemple.com)
                            </code>
                            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Ouvre le client mail</p>
                        </div>
                    </div>

                    <div class="mt-6 pt-4 border-t border-gray-200 dark:border-gray-700">
                        <h3 class="text-sm font-semibold text-gray-900 dark:text-white mb-2">Exemple complet :</h3>
                        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-3 text-xs text-gray-600 dark:text-gray-400 font-mono">
                            <p class="mb-1">Partenaire officiel de la</p>
                            <p class="mb-1">**Communaut√© de Communes**.</p>
                            <p class="mb-1"></p>
                            <p class="mb-1">Visitez [notre site](https://example.com)</p>
                            <p>ou contactez-nous par email.</p>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

{% block javascript %}
<script>
function toggleLienFields() {
    const typeLien = document.getElementById('id_type_lien').value;
    const lienExterneField = document.getElementById('lien-externe-field');
    const lienInterneField = document.getElementById('lien-interne-field');
    
    if (typeLien === 'externe') {
        lienExterneField.classList.remove('hidden');
        lienInterneField.classList.add('hidden');
    } else if (typeLien === 'interne') {
        lienExterneField.classList.add('hidden');
        lienInterneField.classList.remove('hidden');
    } else {
        lienExterneField.classList.add('hidden');
        lienInterneField.classList.add('hidden');
    }
}

// Initialiser au chargement de la page
document.addEventListener('DOMContentLoaded', function() {
    toggleLienFields();
});
</script>
{% endblock javascript %}
{% endblock content %}
